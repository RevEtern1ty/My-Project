/*C2*/SET SCHEMA PUBLIC
set schema PUBLIC
DROP TABLE task_log IF EXISTS
DROP TABLE task_item IF EXISTS
DROP TABLE task IF EXISTS
DROP TABLE workstation IF EXISTS
DROP TABLE employee IF EXISTS
CREATE TABLE employee (\u000d\u000a                          id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL,\u000d\u000a                          employee_code   VARCHAR(20) NOT NULL,\u000d\u000a                          full_name       VARCHAR(120) NOT NULL,\u000d\u000a                          email           VARCHAR(120),\u000d\u000a                          is_active       BOOLEAN DEFAULT TRUE NOT NULL,\u000d\u000a                          created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\u000d\u000a\u000d\u000a                          CONSTRAINT employee_pk PRIMARY KEY (id),\u000d\u000a                          CONSTRAINT employee_code_uq UNIQUE (employee_code),\u000d\u000a                          CONSTRAINT employee_email_uq UNIQUE (email)\u000d\u000a)
CREATE TABLE workstation (\u000d\u000a                             id            BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL,\u000d\u000a                             code          VARCHAR(20) NOT NULL,\u000d\u000a                             name          VARCHAR(80) NOT NULL,\u000d\u000a                             area          VARCHAR(80),\u000d\u000a                             is_active     BOOLEAN DEFAULT TRUE NOT NULL,\u000d\u000a                             created_at    TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\u000d\u000a\u000d\u000a                             CONSTRAINT workstation_pk PRIMARY KEY (id),\u000d\u000a                             CONSTRAINT workstation_code_uq UNIQUE (code)\u000d\u000a)
CREATE TABLE task (\u000d\u000a                      id              BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL,\u000d\u000a                      task_code       VARCHAR(30) NOT NULL,\u000d\u000a                      title           VARCHAR(200) NOT NULL,\u000d\u000a                      description     VARCHAR(2000),\u000d\u000a\u000d\u000a    -- status: TODO / IN_PROGRESS / DONE / CANCELLED\u000d\u000a                      status          VARCHAR(20) NOT NULL,\u000d\u000a\u000d\u000a    -- priority: LOW / MEDIUM / HIGH\u000d\u000a                      priority        VARCHAR(10) NOT NULL,\u000d\u000a\u000d\u000a                      due_date        DATE,\u000d\u000a\u000d\u000a                      employee_id     BIGINT,\u000d\u000a                      workstation_id  BIGINT,\u000d\u000a\u000d\u000a                      created_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\u000d\u000a                      updated_at      TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\u000d\u000a\u000d\u000a                      CONSTRAINT task_pk PRIMARY KEY (id),\u000d\u000a                      CONSTRAINT task_code_uq UNIQUE (task_code),\u000d\u000a\u000d\u000a                      CONSTRAINT task_status_ck CHECK (status IN ('TODO','IN_PROGRESS','DONE','CANCELLED')),\u000d\u000a                      CONSTRAINT task_priority_ck CHECK (priority IN ('LOW','MEDIUM','HIGH')),\u000d\u000a\u000d\u000a                      CONSTRAINT task_employee_fk FOREIGN KEY (employee_id) REFERENCES employee(id),\u000d\u000a                      CONSTRAINT task_workstation_fk FOREIGN KEY (workstation_id) REFERENCES workstation(id)\u000d\u000a)
CREATE INDEX idx_task_status ON task(status)
CREATE INDEX idx_task_employee ON task(employee_id)
CREATE INDEX idx_task_workstation ON task(workstation_id)
CREATE TABLE task_log (\u000d\u000a                          id                     BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1) NOT NULL,\u000d\u000a                          task_id                BIGINT NOT NULL,\u000d\u000a\u000d\u000a    -- event_type: CREATED / STATUS_CHANGE / COMMENT / ASSIGNMENT_CHANGE\u000d\u000a                          event_type             VARCHAR(30) NOT NULL,\u000d\u000a\u000d\u000a                          old_status             VARCHAR(20),\u000d\u000a                          new_status             VARCHAR(20),\u000d\u000a\u000d\u000a                          message                VARCHAR(2000),\u000d\u000a\u000d\u000a                          created_by_employee_id BIGINT,\u000d\u000a                          created_at             TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\u000d\u000a\u000d\u000a                          CONSTRAINT task_log_pk PRIMARY KEY (id),\u000d\u000a                          CONSTRAINT task_log_task_fk FOREIGN KEY (task_id) REFERENCES task(id) ON DELETE CASCADE,\u000d\u000a                          CONSTRAINT task_log_created_by_fk FOREIGN KEY (created_by_employee_id) REFERENCES employee(id),\u000d\u000a\u000d\u000a                          CONSTRAINT task_log_event_type_ck CHECK (event_type IN ('CREATED','STATUS_CHANGE','COMMENT','ASSIGNMENT_CHANGE')),\u000d\u000a                          CONSTRAINT task_log_status_ck CHECK (\u000d\u000a                              (old_status IS NULL OR old_status IN ('TODO','IN_PROGRESS','DONE','CANCELLED'))\u000d\u000a                                  AND\u000d\u000a                              (new_status IS NULL OR new_status IN ('TODO','IN_PROGRESS','DONE','CANCELLED'))\u000d\u000a                              )\u000d\u000a)
CREATE INDEX idx_task_log_task_id ON task_log(task_id)
/*C3*/SET SCHEMA PUBLIC
DISCONNECT
/*C4*/SET SCHEMA PUBLIC
DISCONNECT
/*C5*/SET SCHEMA PUBLIC
DISCONNECT
/*C7*/SET SCHEMA PUBLIC
set schema PUBLIC
INSERT INTO EMPLOYEE VALUES(1,'EMP001','Ivan Petrov','ivan.petrov@factory.local',TRUE,'2025-12-17 12:56:54.939065')
INSERT INTO EMPLOYEE VALUES(2,'EMP002','Anna Smirnova','anna.smirnova@factory.local',TRUE,'2025-12-17 12:56:54.939065')
INSERT INTO EMPLOYEE VALUES(3,'EMP003','Marko Tamm','marko.tamm@factory.local',TRUE,'2025-12-17 12:56:54.939065')
COMMIT
INSERT INTO WORKSTATION VALUES(1,'WS1','Cutting','Production',TRUE,'2025-12-17 12:56:54.960214')
INSERT INTO WORKSTATION VALUES(2,'WS2','Stripping','Production',TRUE,'2025-12-17 12:56:54.960214')
INSERT INTO WORKSTATION VALUES(3,'WS3','Crimping','Production',TRUE,'2025-12-17 12:56:54.960214')
INSERT INTO WORKSTATION VALUES(4,'WS4','Assembly','Production',TRUE,'2025-12-17 12:56:54.960214')
INSERT INTO WORKSTATION VALUES(5,'WS5','Quality Check','Quality',TRUE,'2025-12-17 12:56:54.960214')
COMMIT
INSERT INTO TASK VALUES(1,'TASK-0001','Prepare BOM for new cable harness','Create BOM and verify lengths/strip parameters according to drawing revision.','TODO','HIGH','2026-01-10',1,1,'2025-12-17 12:56:54.993213','2025-12-17 12:56:54.993213')
INSERT INTO TASK VALUES(2,'TASK-0002','Crimp validation for batch #A9069xx','Run crimp pull-force test and record results. Attach photos to report.','IN_PROGRESS','HIGH','2026-01-08',2,3,'2025-12-17 12:56:54.993213','2025-12-17 12:56:54.993213')
INSERT INTO TASK VALUES(3,'TASK-0003','Final QA inspection - 10 pcs','Perform final inspection by THR checklist, confirm marking positions.','TODO','MEDIUM','2026-01-12',3,5,'2025-12-17 12:56:54.993213','2025-12-17 12:56:54.993213')
INSERT INTO TASK VALUES(4,'TASK-0004','Update assembly instruction','Update assembly instruction: half strip requirement and label placement.','DONE','LOW','2026-01-05',1,4,'2025-12-17 12:56:54.993213','2025-12-17 12:56:54.993213')
INSERT INTO TASK VALUES(5,'TASK-0005','Prepare workstation setup for new order','Check tools, labels and materials availability for upcoming production order.','TODO','MEDIUM','2026-01-09',2,2,'2025-12-17 12:56:54.993213','2025-12-17 12:56:54.993213')
COMMIT
INSERT INTO TASK_LOG VALUES(1,1,'CREATED',NULL,'TODO','Task created from production request.',1,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(2,2,'CREATED',NULL,'TODO','Task created for validation batch.',2,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(3,2,'STATUS_CHANGE','TODO','IN_PROGRESS','Started pull-force tests on first samples.',2,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(4,4,'CREATED',NULL,'TODO','Instruction update requested.',1,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(5,4,'STATUS_CHANGE','TODO','DONE','Instruction updated and approved.',1,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(6,3,'CREATED',NULL,'TODO','QA inspection task created for final batch.',3,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(7,5,'CREATED',NULL,'TODO','Workstation preparation task created.',2,'2025-12-17 12:56:55.000211')
INSERT INTO TASK_LOG VALUES(8,5,'COMMENT',NULL,NULL,'Waiting for materials confirmation from warehouse.',2,'2025-12-17 12:56:55.000211')
COMMIT
/*C6*/SET SCHEMA PUBLIC
DISCONNECT
/*C10*/SET SCHEMA PUBLIC
DISCONNECT
/*C9*/SET SCHEMA PUBLIC
DISCONNECT
/*C8*/SET SCHEMA PUBLIC
DISCONNECT
/*C11*/SET SCHEMA PUBLIC
DISCONNECT
